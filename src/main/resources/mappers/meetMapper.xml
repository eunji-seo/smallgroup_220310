<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

 <mapper namespace="com.smallgroup.meet.dao.MeetDAO">
 	<select id="selectFavoriteById" parameterType="String" resultType="com.smallgroup.user.model.Favorite">
 		SELECT
 			`id`
			,`favoriteName`
			,`createdAt`
			,`updatedAt`
 		FROM
 			`favorite`
 	</select>
 	<insert id="insertMeet" parameterType="map">
	 	INSERT INTO `meet`
	 	(
	 		`userId`
	 		,`joinName`
			,`favoriteId`
			,`meetAddress`
			,`meetName`
			,`desc`
			,`meetImagePath`
			,`personnel`
			,`createdAt`
			,`updatedAt`
	 			
	 	)
	 	VALUES
	 	(
	 		#{userId}
	 		,#{joinName}
	 		,#{favoriteId}
	 		,#{meetAddress}
	 		,#{meetName}
	 		,#{desc}
	 		,#{meetImagePath}
	 		,#{personnel}
	 		,NOW()
	 		,NOW()	 		
	 	)
 	</insert>
 	<select id="selectMeetById" resultType="com.smallgroup.meet.model.Meet">
 		SELECT * FROM meet
 		WHERE
 			id = #{meetId}
 	</select>
 	<select id="selectMeetingById" resultType="com.smallgroup.meet.model.MeetingAttend">
 		SELECT * FROM meetingAttend
 		WHERE
 			id = #{meetingId}
 	</select>
 	<select id="selectMeetListByMeetFavoriteId" resultType="com.smallgroup.meet.model.Meet">
 		SELECT * FROM meet
 		<where>
 			<if test='FavoriteId != null and FavoriteId != 0'>
 				AND FavoriteId =#{FavoriteId}
 			</if>
 		</where>
 	</select>
 	<select id="selectMeetListByMeetAndUserId" resultType="com.smallgroup.meet.model.Meet">
 		SELECT * 
 		FROM meet as a
 		JOIN meet_join as b
 		ON a.id = b.meetId
        where 
			a.userid = #{userId}
 	</select>
 	<select id="selectMeetListByJoinAndUserId" resultType="com.smallgroup.meet.model.Meet">
 		SELECT * 
 		FROM meet as a
 		JOIN meet_join as b
 		ON a.id = b.meetId
        where 
			b.userid = #{userId}
 	</select>
 	<insert id="insertJoin">
	 	INSERT INTO `meet_join`
	 	(
	 		`meetId`
			,`userId`
			,`joinName`
			,`createdAt`
			,`updatedAt`
	 			
	 	)
	 	VALUES
	 	(
	 		#{meetId}
	 		,#{userId}
	 		,#{joinName}
	 		,NOW()
	 		,NOW()	 		
	 	)
 	</insert>
 	<insert id="insertAttend">
	 	INSERT INTO `meeting_Attend`
	 	(
	 		`userId`
			,`meetId`
			,`meetingId`
			,`attendName`
			,`createdAt`
			,`updatedAt`
	 			
	 	)
	 	VALUES
	 	(
	 		#{userId}
	 		,#{meetId}
	 		,#{meetingId}
	 		,#{attendName}
	 		,NOW()
	 		,NOW()	 		
	 	)
 	</insert>
 	<select id="getRederName" resultType="com.smallgroup.user.model.User">
 		SELECT  *
		FROM user 
		JOIN meet 
		ON user.id = meet.userId
		where meet.id = #{meetId}
 	</select>
 	<select id="getJoinName" resultType="com.smallgroup.meet.model.MeetJoin">
 		select
 			`id` 
 			,`meetId`
			,`userId`
			,`joinName`
			,`createdAt`
			,`updatedAt`
 		from meet_join
 		where meetId = #{meetId}
 	</select>
 	<select id="getJoinNameByName" resultType="int">
 		select count(1)
 		from meet_join
 		where
		userId = #{userId}
		and meetId = #{meetId}
 	</select>
 	<insert id="insertMeeting">
	 	INSERT INTO `meeting`
	 	(
	 		
	 		`userId`
	 		,`meetId`
			,`meetingName`
			,`meetingDay`
			,`Place`
			,`Cost`
			,`Personnel`
			,`createdAt`
			,`updatedAt`
	 			
	 	)
	 	VALUES
	 	(
	 		#{userId}
	 		,#{meetId}
	 		,#{meetingName}
	 		,#{meetingDay}
	 		,#{place}
	 		,#{cost}
	 		,#{personnel}
	 		,NOW()
	 		,NOW()	 		
	 	)
 	</insert>
 	<select id="selectMeetingList" resultType="com.smallgroup.meet.model.Meeting">
 		SELECT
 			`id` 
 			,`userId`
	 		,`meetId`
			,`meetingName`
			,`meetingDay`
			,`Place`
			,`Cost`
			,`Personnel`
			,`createdAt`
			,`updatedAt`
		
		FROM meeting
 		where meetId = #{meetId}
 	</select>
 	<select id="selectMeeting" resultType="com.smallgroup.meet.model.Meeting">
 		SELECT `id` 
 			,`userId`
	 		,`meetId`
			,`meetingName`
			,`meetingDay`
			,`Place`
			,`Cost`
			,`Personnel`
			,`createdAt`
			,`updatedAt` 
 		FROM meeting
 		where 
 			meetId = #{meetId}
 		and id = #{meetingId}
 	</select>
	<select id="getMeetingAttendList" resultType="com.smallgroup.meet.model.MeetingAttend">
		SELECT
			id
			,userId
			,meetId
			,meetingId
			,attendName
		FROM
			`meeting_attend`
 		WHERE
			meetingId = #{meetingId}
	</select>
 </mapper>